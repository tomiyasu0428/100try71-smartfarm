**SmartFarm Agent 各ページ詳細定義**

**1\. ダッシュボード**

* **目的:** ログイン後、ユーザーが最初に目にする画面。システム全体の状況を素早く把握し、直近のタスクや重要な情報に気づき、主要機能へアクセスする起点となる。  
* **主要な表示項目:**  
  * **今日の作業予定:** 当日の `Scheduled Task` \[source: 11\] をカード形式やリストで表示（タスク名、圃場名、担当者、ステータス）。  
  * **天気予報:** （外部API連携時 \[source: 4\]）当日の天気、気温、降水確率など。  
  * **通知エリア:** AIからの提案 \[source: 4\]（例：「XX圃場の防除タイミングです」）、アラート（例：「資材YYの在庫が少なくなっています」）、システムからのお知らせなどをリスト表示。未読件数バッジ。  
  * **圃場サマリ:** 管理圃場数 (`field`テーブルのカウント）、総面積（`area`の合計）、主な作付作物（`field`テーブルの`crop_type`から集計）など。  
  * **クイックアクセスボタン:** よく使う機能へのショートカット（例：「作業記録をつける」「チャットで質問」「圃場マップを開く」）。  
  * **最近のアクティビティ（オプション）:** 直近で登録された作業記録 (`usage_log` \[source: 11\]) や更新された圃場情報などをリスト表示。  
* **主要な機能:**  
  * 作業予定カード/リスト項目クリック \-\> 対応する作業詳細画面（作業管理画面内）へ遷移。  
  * 通知項目クリック \-\> 詳細表示（チャットでの関連メッセージや詳細画面へ遷移）。通知の既読/削除。  
  * 圃場サマリクリック \-\> 圃場管理画面へ遷移。  
  * クイックアクセスボタンクリック \-\> 対応する機能（チャット画面、作業登録画面、圃場管理画面など）へ遷移。  
* **UI要素:** カードコンポーネント、リストコンポーネント、ボタン、アイコン、グラフ（簡易的なサマリ用、オプション）。  
* **画面遷移:** 各種詳細画面、機能画面へ。  
* **レスポンシブ対応:** スマホでは縦一列にカードを配置。PCでは複数カラムレイアウトも検討。表示情報量を調整。  
* **チャット連携:** 通知エリアはチャットでのAI通知と連動。「チャットで質問」ボタンからチャット画面へ遷移。

**2\. チャット画面**

* **目的:** AIエージェントとの対話を通じて、情報照会、簡易なデータ登録・更新、AIからの提案・通知の受け取りと応答を行う主要インターフェース。  
* **主要な表示項目:**  
  * 会話履歴（ユーザーの発話、AIの応答テキスト、カード、リスト、ボタンなど）。  
  * メッセージ入力欄。  
* **主要な機能:**  
  * テキストメッセージ入力・送信。  
  * 音声入力・送信（マイクアイコンタップ）\[source: 2, 4\]。  
  * AIが提示したボタン（クイックリプライ、確認ボタン、画面遷移ボタンなど）のクリック/タップ。  
  * AIが提示したカードやリスト内のリンククリック \-\> 詳細画面や補助ビュー（地図ポップアップ等）へ遷移/表示。  
  * 会話履歴のスクロール。  
* **UI要素:** 会話履歴表示エリア、テキスト入力フィールド、送信ボタン、マイクボタン、各種応答コンポーネント（カード、リスト、ボタン）。  
* **画面遷移:** AIの応答に含まれるリンクやボタンから、他の詳細画面や補助ビューへ遷移/表示。ナビゲーションメニューから他の主要画面へも遷移可能。  
* **レスポンシブ対応:** スマホでの利用を前提としたデザイン。PCでも同様のインターフェースを提供。  
* **チャット連携:** この画面自体がチャット機能の中核。

**3\. 圃場管理画面**

* **目的:** 管理下の圃場の位置、形状、基本情報を地図と一覧で統合的に確認・管理し、詳細情報の参照や登録・編集画面へのアクセスを行う。  
* **主要な表示項目:**  
  * **地図エリア:** Google Map上に登録圃場 (`field`テーブル) のポリゴン (`coordinates` \[source: 16\]) を表示。ポリゴンのスタイル（色など）は作付作物 (`crop_type`) などに応じて変更可能（将来拡張）\[source: 3\]。選択中ポリゴンのハイライト。  
  * **一覧エリア:** 圃場名 (`name`)、作付中の作物名 (`crop_type`)、面積 (`area` \[source: 16\])、最終更新日などをテーブル表示。  
* **主要な機能:**  
  * 地図操作：移動、拡大縮小、地図/航空写真切り替え。  
  * ポリゴンクリック/タップ：簡易情報ポップアップ（圃場名、面積、作物）を表示し、詳細画面へのリンクを提供 \[source: 3\]。  
  * 一覧の検索ボックス：圃場名、作物名などでインクリメンタル検索またはEnterで検索。  
  * 一覧のフィルター：作付作物、土壌タイプ、タグなどで絞り込み（ドロップダウン等）。  
  * 一覧のソート：各カラム（圃場名、面積、更新日）で昇順/降順ソート。  
  * ページネーション：圃場数が多い場合に一覧をページ分割表示。  
  * **「新規圃場登録」ボタン:** 圃場登録/編集画面へ遷移。  
  * 一覧の各行：クリック/タップで圃場詳細画面（または編集画面）へ遷移。  
  * 一覧の各行に編集ボタン/削除ボタン（削除は確認ダイアログ表示）。  
  * （オプション）一覧の行を選択すると地図上の対応するポリゴンがハイライト/ズームされる連携。  
* **UI要素:** Google Mapコンポーネント、データテーブル、検索ボックス、ドロップダウンフィルター、ソートアイコン付きテーブルヘッダー、ページネーションコントロール、ボタン。  
* **画面遷移:** 圃場登録/編集画面へ。圃場詳細画面へ（別画面 or モーダル）。  
* **レスポンシブ対応:** スマホでは地図と一覧をタブやアコーディオンで切り替え。一覧テーブルは主要項目のみ表示し、横スクロールまたは詳細画面で全項目表示。地図操作はピンチイン/アウト。  
* **チャット連携:** チャットで特定の圃場について言及された際、この画面を開いて該当圃場をハイライト表示する連携。「この圃場についてチャットで質問する」ボタン（オプション）。

**3.1. 圃場登録/編集画面 (専用フォーム)**

* **目的:** 新規圃場の登録、または既存圃場の詳細情報を編集する。  
* **主要な表示項目/入力項目:**  
  * 圃場名 (`name`): テキスト入力 (必須)。  
  * 作付中の作物 (`crop_type`): 作物マスタからの選択式ドロップダウンまたは検索可能なリスト。  
  * 土壌タイプ (`soil_type`): テキスト入力または選択式。  
  * メモ (`notes`): テキストエリア。  
  * **地図描画エリア:**  
    * Google Map表示。  
    * ポリゴン描画ツール（新規作成、頂点追加/移動/削除）\[source: 3\]。  
    * 既存圃場の場合は登録済みのポリゴン (`coordinates`) を表示・編集可能。  
  * 面積 (`area`): 地図描画後に自動計算された値（ヘクタールまたは平方メートル）を表示（編集不可）\[source: 2, 16\]。  
  * 登録者/更新者情報、日時（表示のみ）。  
* **主要な機能:**  
  * フォーム入力。  
  * 地図上でのポリゴン描画・編集操作。  
  * 「保存」ボタン：入力内容と描画されたポリゴン座標・計算された面積を `field` テーブルに保存/更新。保存後、圃場管理画面または詳細画面に戻る。  
  * 「キャンセル」ボタン：変更を破棄して前の画面に戻る。  
* **UI要素:** フォーム入力フィールド（テキスト、ドロップダウン、テキストエリア）、Google Mapコンポーネントと描画ライブラリ、ボタン。  
* **画面遷移:** 圃場管理画面または圃場詳細画面から遷移してくる。保存/キャンセル後に戻る。  
* **レスポンシブ対応:** スマホでも地図描画・フォーム入力がしやすいよう、要素サイズやレイアウトを調整。地図エリアとフォームエリアの配置を工夫。  
* **チャット連携:** チャットで「新しい圃場を登録」と指示された場合に、この画面に直接遷移させることが可能。

**4\. 作付け計画画面**

* **目的:** 作付け計画 (`Cultivation Plan` \[source: 11\]) を一覧で確認・管理し、新規作成や編集画面へのアクセスを行う。  
* **主要な表示項目:**  
  * 作付け計画の一覧をテーブル表示：計画名、対象圃場 (`field_id` \-\> 圃場名)、作物 (`crop_id` \-\> 作物名/品種)、作付期間（年/開始日～終了日）、適用されている作業テンプレート名 (`Applied Workflow` \[source: 11\] 経由)、ステータス（計画中、進行中、完了など）。  
* **主要な機能:**  
  * 一覧の検索ボックス：計画名、圃場名、作物名などで検索。  
  * 一覧のフィルター：年度、作物、ステータスなどで絞り込み。  
  * 一覧のソート：各カラムでソート。  
  * ページネーション。  
  * **「新規作付け計画作成」ボタン:** 作付け計画登録/編集画面へ遷移。  
  * 一覧の各行：クリック/タップで詳細表示（関連する作業タスク一覧など）または編集画面へ遷移。  
  * 一覧の各行に編集ボタン/削除ボタン（削除は確認ダイアログ表示）。  
* **UI要素:** データテーブル、検索ボックス、ドロップダウンフィルター、ソートアイコン付きテーブルヘッダー、ページネーションコントロール、ボタン。  
* **画面遷移:** 作付け計画登録/編集画面へ。計画詳細表示画面/モーダルへ。  
* **レスポンシブ対応:** スマホでは表示項目を絞ったテーブルと横スクロール、またはカード形式リスト表示を検討。  
* **チャット連携:** チャットで「XX年のトマトの作付け計画は？」と聞かれた際に、この画面のフィルタリング結果へのリンクを提示可能。「この計画の作業状況をチャットで聞く」ボタン（オプション）。

**4.1. 作付け計画登録/編集画面 (専用フォーム)**

* **目的:** 新規作付け計画の作成、または既存計画の内容を編集する。  
* **主要な表示項目/入力項目:**  
  * 計画名：テキスト入力。  
  * 対象年度 (`year`): 数値入力または選択式。  
  * 対象圃場 (`field_id`): 圃場リストからの複数選択チェックボックスまたはタグ形式入力。  
  * 対象作物 (`crop_id`): 作物マスタからの選択式ドロップダウン（品種 (`variety`) も選択）。  
  * 作付期間：開始日、終了日のカレンダー選択。  
  * **作業テンプレートの適用 (`Applied Workflow`):**  
    * `CropWorkflowTemplate` \[source: 11\] のリストから選択。  
    * 選択したテンプレートに基づいて、標準的な作業フェーズ (`CropWorkflowPhase`) と作業タスク (`CropWorkflowTask`) \[source: 11\] が自動的に `Scheduled Task` として展開される（確認・調整可能にするか検討）。  
  * 担当者：ユーザーリストから選択（任意）。  
  * 備考：テキストエリア。  
* **主要な機能:**  
  * フォーム入力・選択。  
  * 「保存」ボタン：入力内容を `Cultivation Plan` および関連テーブル (`Applied Workflow`, `Scheduled Task`) に保存/更新。保存後、作付け計画画面に戻る。  
  * 「キャンセル」ボタン：変更を破棄して前の画面に戻る。  
* **UI要素:** フォーム入力フィールド（テキスト、数値、日付選択、複数選択リスト、ドロップダウン）、ボタン。  
* **画面遷移:** 作付け計画画面から遷移してくる。保存/キャンセル後に戻る。  
* **レスポンシブ対応:** フォーム項目が多い場合、ステップ形式やアコーディオンで見せ方を工夫。  
* **チャット連携:** チャットで「トマトの作付け計画作成」と指示された場合に、作物「トマト」が選択された状態でこの画面を開くことが可能。

**5\. 作業管理画面**

* **目的:** 農作業の予定 (`Scheduled Task`) と実績 (`UsageLog` 等と関連）をカレンダーまたはリスト形式で確認・管理し、新規登録や編集を行う。  
* **主要な表示項目:**  
  * **カレンダー表示:** 月/週/日単位で作業予定・実績をイベントとして表示。イベントには作業種類、圃場名、担当者、ステータスなどを表示。  
  * **一覧表示:** 作業を時系列などのリストでテーブル表示（作業日、作業種類、圃場、担当者、ステータス、使用資材・時間など）。  
* **主要な機能:**  
  * カレンダー/一覧表示の切り替えタブ/ボタン。  
  * カレンダーの日付範囲変更（前月/次月など）。  
  * 一覧の検索、フィルター（期間、作業種類、担当者、圃場、ステータス）。  
  * 一覧のソート、ページネーション。  
  * カレンダーのイベントクリック/タップ、または一覧の行クリック/タップで作業詳細表示（モーダル等）または編集画面へ遷移。  
  * **「新規作業登録」ボタン:** 作業登録/編集画面へ遷移。  
  * （カレンダー）ドラッグ＆ドロップでの日付変更（予定のみ）。  
  * （一覧）ステータス変更ボタン/ドロップダウン。  
  * （一覧）各行に編集ボタン/削除ボタン。  
* **UI要素:** カレンダーコンポーネント、データテーブル、タブ、ボタン、検索ボックス、フィルタードロップダウン、モーダルウィンドウ。  
* **画面遷移:** 作業登録/編集画面へ。作業詳細モーダル表示。  
* **レスポンシブ対応:** スマホではカレンダー表示を月表示から週/日表示メインにするか、リスト表示をデフォルトにする。テーブルは表示項目を絞る。  
* **チャット連携:** チャットで「明日の作業予定は？」と聞かれた際にこの画面のカレンダー/リストへのリンクを提示。チャットで簡易登録した作業もここに反映。「この作業についてチャットで質問/報告する」ボタン（オプション）。

**5.1. 作業登録/編集画面 (専用フォーム)**

* **目的:** 新規作業の予定または実績を登録する、または既存の作業情報を編集する。  
* **主要な表示項目/入力項目:**  
  * 作業日 (`task_date` \[source: 6\]) / 予定日 (`scheduled_date` \[source: 11\]): カレンダー選択 (必須)。  
  * 作業種類 (`task_type` \[source: 6\] / `category_id` \[source: 11\]): `CropWorkCategory` \[source: 11\] からの選択式ドロップダウン (必須)。  
  * 対象圃場 (`field_id` \[source: 6\]): 圃場リストからの選択式ドロップダウン (必須)。  
  * 担当者 (`worker_id` \[source: 6\]): ユーザーリストからの選択式（単一/複数選択）。  
  * ステータス (`status` \[source: 6, 11\]): 選択式（予定、実施中、完了、キャンセルなど）。  
  * **使用資材/農機 (`TaskMaterial` \[source: 11\], `UsageLog` \[source: 11\]):**  
    * 資材/農機を選択 (`Resource`/`Material`/`Equipment` \[source: 11\] から）。  
    * 使用量/稼働時間を入力。  
    * 複数追加可能にする。  
  * 作業時間（実績）：時間入力フィールド（例：「2時間30分」）。  
  * 備考 (`remarks` \[source: 6\]): テキストエリア。  
* **主要な機能:**  
  * フォーム入力・選択。  
  * 使用資材/農機の追加・削除。  
  * 「保存」ボタン：入力内容を `Scheduled Task`, `UsageLog` 等の関連テーブルに保存/更新。保存後、作業管理画面に戻る。  
  * 「キャンセル」ボタン：変更を破棄して前の画面に戻る。  
* **UI要素:** フォーム入力フィールド（日付選択、ドロップダウン、ユーザー選択、数値入力、テキストエリア）、動的なリスト追加/削除コンポーネント、ボタン。  
* **画面遷移:** 作業管理画面から遷移してくる。保存/キャンセル後に戻る。  
* **レスポンシブ対応:** スマホでも入力しやすいフォーム要素サイズ。  
* **チャット連携:** チャットで「今日のXX作業を記録して」のように指示された場合、可能な範囲で情報を抽出し、不足項目のみ入力が必要な状態でこの画面を開く、またはチャット内で完結させる。

**6\. 資材・農機管理画面**

* **目的:** 組織が保有する資材（肥料、農薬など）と農機（トラクターなど）の情報を一覧で管理し、在庫/状態の確認、新規登録、入出庫/メンテナンス記録を行う。  
* **主要な表示項目:**  
  * 資材/農機の切り替えタブまたはセクション。  
  * **資材一覧:** 名称 (`name`)、種類 (`resource_type`)、現在の在庫数 (`quantity`)、単位 (`unit`)、最終更新日などをテーブル表示。  
  * **農機一覧:** 名称 (`name`)、種類 (`resource_type`)、状態（利用可能、メンテ中など）、最終メンテナンス日 (`last_maintenance_date` \[source: 6\]) などをテーブル表示。  
* **主要な機能:**  
  * 一覧の検索、フィルター、ソート、ページネーション。  
  * **「新規資材登録」「新規農機登録」ボタン:** 対応する登録/編集画面へ遷移。  
  * **「入庫」「出庫」ボタン（資材）:** 在庫数を更新するための専用フォーム/モーダルを開く。  
  * **「メンテナンス記録」ボタン（農機）:** メンテナンス情報を記録するための専用フォーム/モーダルを開く。  
  * 一覧の各行から編集画面へ遷移、削除ボタン。  
* **UI要素:** タブ、データテーブル、検索ボックス、フィルター、ソート、ページネーション、ボタン、モーダルウィンドウ。  
* **画面遷移:** 各種登録/編集/記録用フォーム画面（またはモーダル）へ。  
* **レスポンシブ対応:** スマホではテーブル表示項目を絞る。  
* **チャット連携:** チャットで「XXの在庫は？」と聞かれた際に、この画面の情報（またはその一部）を提示。「資材XXを10袋使った」というチャット報告を受けて、裏側で在庫数を更新（UsageLog経由）。

**6.1. 資材/農機 登録/編集/記録画面 (専用フォーム/モーダル)**

* **目的:** 資材/農機の新規登録、情報編集、入出庫記録、メンテナンス記録を行う。  
* **UI要素:** 各操作に応じたシンプルなフォーム。  
  * **登録/編集:** 名称、種類、単位、初期在庫数、管理番号、購入日、メモなど。  
  * **入出庫:** 対象資材選択、数量、日付、理由/関連作業。  
  * **メンテナンス:** 対象農機選択、メンテナンス日、内容、費用、次回予定日。  
  * 保存/キャンセルボタン。  
* **画面遷移:** 資材・農機管理画面から開かれ、保存/キャンセル後に戻る。

**7\. レポート画面**

* **目的:** 蓄積された営農データ（作業履歴、資材使用量、圃場別収穫量など）を集計し、指定した形式でレポートとして出力・確認する。  
* **主要な表示項目/入力項目:**  
  * レポート種別選択：ドロップダウンリスト（例：「期間別作業一覧」「圃場別作業時間集計」「資材使用量レポート」「作物別収穫量比較」など）。  
  * 集計期間指定：開始日、終了日のカレンダー選択。  
  * フィルタリング条件：圃場選択、作物選択、作業種類選択、担当者選択などのオプション（レポート種別に応じて表示）。  
  * 出力形式選択：ラジオボタンまたはドロップダウン（PDF, Excel/CSV \[source: 4\]）。  
  * （オプション）グラフ表示エリア：レポート内容をグラフでプレビュー表示 \[source: 2\]。  
* **主要な機能:**  
  * レポート条件の選択・指定。  
  * 「レポート生成」ボタン：指定された条件でデータを集計し、プレビュー表示またはファイルダウンロードを開始。  
  * （オプション）グラフの種類切り替え。  
  * （オプション）過去に生成したレポート履歴の表示・再ダウンロード。  
* **UI要素:** ドロップダウン、日付選択カレンダー、チェックボックス/複数選択リスト（フィルター用）、ラジオボタン、ボタン、グラフ表示ライブラリ（オプション）、ファイルダウンロード機能。  
* **画面遷移:** ナビゲーションメニューからアクセス。レポートファイルがダウンロードされる。  
* **レスポンシブ対応:** 条件指定フォームをスマホでも使いやすく配置。グラフ表示は横スクロールや表示切り替えで対応。  
* **チャット連携:** チャットで「先月の作業レポートをExcelで出して」と指示された場合に、この画面で条件が設定された状態にするか、直接ファイルを生成してダウンロードリンクをチャットで返す。

**8\. 管理画面 (ユーザー/組織/作物マスタ)**

* **目的:** システムの基本的な設定やマスターデータを管理する（主に管理者権限ユーザー向け）。  
* **構成:** 左側に管理項目メニュー（ユーザー管理、組織設定、作物マスタ）、右側に選択された項目の管理インターフェースを表示するようなレイアウトを想定。  
* **8.1. ユーザー管理:**  
  * 表示：ユーザー一覧（名前、メールアドレス、権限ロール `role` \[source: 14\]、所属組織 `organization_id`）。  
  * 機能：新規ユーザー招待/登録、ユーザー情報編集（権限変更含む）、パスワードリセット（Supabase Auth連携）、ユーザー削除/無効化。検索、フィルター。  
* **8.2. 組織設定:**  
  * 表示：組織名 (`name` \[source: 14\])、住所、連絡先などの基本情報。  
  * 機能：組織情報の編集。マルチテナントでなければ項目は少ない。  
* **8.3. 作物マスタ管理:**  
  * 表示：作物一覧（作物名 `name`、品種 `variety`、カテゴリ `category`、標準栽培日数 `default_growing_days` \[source: 17\] など）。  
  * 機能：新規作物登録、既存作物情報の編集、削除。検索、フィルター。登録/編集用フォーム画面（またはモーダル）を使用。  
* **UI要素:** サイドメニュー、データテーブル、フォーム、ボタン、検索ボックス、フィルター。  
* **画面遷移:** ナビゲーションメニューからアクセス。各管理項目内で詳細編集画面/モーダルへ遷移。  
* **レスポンシブ対応:** スマホではサイドメニューをハンバーガーメニューにするなど工夫。テーブル表示項目を調整。  
* **チャット連携:** 基本的にこれらの管理機能はGUI操作を前提とする。チャットから直接操作することは想定しない（参照は可能にする場合あり）。

